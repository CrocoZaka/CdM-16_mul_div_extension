# Cdm8 extended
## Что это такое?
Данный репозиторий содержит расширенную версию процессора Cdm8 (Cdm8e) созданную в logisim'е, а так же ассемблер, линкер и эмулятор к нему.
## Отличия от обычного Cdm-8
У Cdm8e 16-битный Program Counter, что позволяет использовать до 64кб памяти кода.
Адресное пространство выглядит следующим образом:\
`0x0000 - 0x00ff` - память кода и данных\
`0x0100 - 0xffff` - память кода

Все инструкции br переходят относительно адреса операнда инструкции (максимум можно прыгнуть на 127 байт).
Абсолютный переход возможен с помощью `jsr` (синтаксис: `0xD6 <PCL> <PCH>`, где PCL и PCH - 16-битный адрес в little-endian формате)

Вектора прерываний занимают 4 байта и имеют следующий формат: `<PCL> <PCH> <PS> 0x00`, PCL и PCH - адрес обработчика, PS - слово состояния процессора.
Нулевой вектор расположен по адресу `0xffe0`

## Зависимости
- python 3.10
- пакеты antlr4-python3-runtime websocket_server bitstruct (``pip3 install --user antlr4-python3-runtime websocket_server bitstruct``)
- java (для тестов)

## Структура репозитория
- `assembler/main.py` - ассемблер, использование - `python main.py filename.asm`, будут созданы файлы `filename.obj` и `filename.img`
- `emulator/emulator.py` - эмулятор Cdm8e, использование - `python emulator.py filename.img`
- `logisim/CdM-8-mark5-full.circ` - реализация Cdm8e в logisim. Пример подключения в схеме `test16`. `test16` Загружает прошивку из файла, перед использованием необходимо собрать `long_code_test.img` и указать путь к нему в атрибутах ROM
- `long_code_test.asm` - прошивка для схемы test16 в `CdM-8-mark5-full.circ`, считает число Фибоначчи рекурсивно
- `assembler/*.g4` - грамматика ассемблера в формате antlr4
- `logisim/*.def` - исходники декодера
- `logisim/generate-decoder.py` - генерирует декодер из .def файлов и вставляет его в `CdM-8-mark5-full.circ`
- `tester/main.py` - тестер, сравнивает работу эмулятора и logisim'а, берёт тесты из папки `tests`
## Что НЕ работает
- CocoIDE
- Ассемблер плохо тестировался с расширенной архитектурой, поддержка нескольких файлов не тестировалась вообще
- Не тестировались rsect, tplate
- Эмулятор поддерживает только Гарвардскую архитектуру и не поддерживает прерывания

